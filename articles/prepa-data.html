<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Préparer les données textuelles • lexico</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Préparer les données textuelles">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">lexico</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/iramuteq.html">Préparer et exploiter des corpus avec IRaMuTeQ</a></li>
    <li><a class="dropdown-item" href="../articles/prepa-data.html">Préparer les données textuelles</a></li>
    <li><a class="dropdown-item" href="../articles/quanteda.html">Analyser les textes avec Quanteda</a></li>
    <li><a class="dropdown-item" href="../articles/scraping.html">Scraper des playlists YouTube</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tdelc/lexico/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Préparer les données textuelles</h1>
                        <h4 data-toc-skip class="author">lexico</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tdelc/lexico/blob/master/vignettes/prepa-data.Rmd" class="external-link"><code>vignettes/prepa-data.Rmd</code></a></small>
      <div class="d-none name"><code>prepa-data.Rmd</code></div>
    </div>

    
    
<p>Cette vignette détaille les étapes de préparation des textes issus
des sous-titres : structuration des segments, nettoyage lexical et
regroupements.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tdelc/lexico" class="external-link">lexico</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">df_text_bfm</span><span class="op">)</span></span>
<span><span class="va">df_text</span> <span class="op">&lt;-</span> <span class="va">df_text_bfm</span></span></code></pre></div>
<div class="section level2">
<h2 id="nettoyer-et-normaliser-le-vocabulaire">Nettoyer et normaliser le vocabulaire<a class="anchor" aria-label="anchor" href="#nettoyer-et-normaliser-le-vocabulaire"></a>
</h2>
<p>Les textes extraits sont issus de sous-titre générés automatiquement
par YouTube. Il y a beaucoup d’erreurs dans ces textes, et un enjeu
important pour l’analyse et de bien nettoyer le fichier avant analyse.
Je propose ici plusieurs étapes de nettoyage</p>
<div class="section level3">
<h3 id="passage-du-texte-en-minuscule">Passage du texte en minuscule<a class="anchor" aria-label="anchor" href="#passage-du-texte-en-minuscule"></a>
</h3>
<p>Pour faciliter le nettoyage puis l’analyse, je commence par passer le
texte en minuscule :</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_text</span> <span class="op">&lt;-</span> <span class="va">df_text</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="va">text</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="suppression-de-mots-spécifiques">Suppression de mots spécifiques<a class="anchor" aria-label="anchor" href="#suppression-de-mots-sp%C3%A9cifiques"></a>
</h3>
<p>Un texte issu de l’oral contient beaucoup d’oralité impropres pour
l’analyse textuelle. Aussi, dans le cas précis de l’analyse sur les
chaînes d’information en continu, le nom des chaînes revient souvient et
il est préférable de les retirer en avance. Une fonction
<code>get_specific_stopwords</code> permet de regrouper les mots que
j’ai jugé utile à retirer, vous pouvez créer votre propre liste.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stopwords</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_specific_stopwords.html">get_specific_stopwords</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">stopwords</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "au"   "aux"  "avec" "ce"   "ces"  "dans"</span></span>
<span><span class="va">stopwords_regex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"\\b(?:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">stopwords</span>, collapse <span class="op">=</span> <span class="st">"|"</span><span class="op">)</span>, <span class="st">")\\b"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_text</span> <span class="op">&lt;-</span> <span class="va">df_text</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove_all</a></span><span class="op">(</span><span class="va">text</span>,<span class="va">stopwords_regex</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="correction-de-mots-spécifiques">Correction de mots spécifiques<a class="anchor" aria-label="anchor" href="#correction-de-mots-sp%C3%A9cifiques"></a>
</h3>
<p>En analysant les mots les plus fréquents, il est possible de
remarquer des mots systématiquement mal orthographié. Il est possible
donc de prévoir un vecteur de mots avec leur correction et de corriger
le texte en une fois. Une fonction <code>get_recode_words</code> prévoit
les corrections que j’ai remarqué, vous pouvez créer votre propre
vecteur.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">recode_words</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_recode_words.html">get_recode_words</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">recode_words</span><span class="op">)</span></span>
<span><span class="co">#&gt; (^|[^a-z])(sarkozi)([^a-z]|$)    (^|[^a-z])(atal)([^a-z]|$) </span></span>
<span><span class="co">#&gt;               "\\1sarkozy\\3"                 "\\1attal\\3" </span></span>
<span><span class="co">#&gt;   (^|[^a-z])(hatal)([^a-z]|$) (^|[^a-z])(baayrou)([^a-z]|$) </span></span>
<span><span class="co">#&gt;                 "\\1attal\\3"                "\\1bayrou\\3" </span></span>
<span><span class="co">#&gt;  (^|[^a-z])(baayou)([^a-z]|$)   (^|[^a-z])(berou)([^a-z]|$) </span></span>
<span><span class="co">#&gt;                "\\1bayrou\\3"                "\\1bayrou\\3"</span></span>
<span></span>
<span><span class="va">df_text</span> <span class="op">&lt;-</span> <span class="va">df_text</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace_all</a></span><span class="op">(</span><span class="va">text</span>, <span class="va">recode_words</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="retrait-des-crochets">Retrait des crochets<a class="anchor" aria-label="anchor" href="#retrait-des-crochets"></a>
</h3>
<p>YouTube ajoute des crochets pour indiquer des rires, des
applaudissements ou de la musique, voici comment retirer ces
passages.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract_all</a></span><span class="op">(</span><span class="va">df_text</span><span class="op">$</span><span class="va">text</span>,<span class="st">"\\[[a-z]+?\\]"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "[rires]"</span></span>
<span></span>
<span><span class="va">df_text</span> <span class="op">&lt;-</span> <span class="va">df_text</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove_all</a></span><span class="op">(</span><span class="va">text</span>,<span class="st">"\\[[a-z]+?\\]"</span><span class="op">)</span>,</span>
<span>         text <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html" class="external-link">str_squish</a></span><span class="op">(</span><span class="va">text</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="ajout-du-nombre-de-mots">Ajout du nombre de mots<a class="anchor" aria-label="anchor" href="#ajout-du-nombre-de-mots"></a>
</h3>
<p>Il est possible d’ajouter le nombre de mots du bloc de texte pour les
analyses futures.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_text</span> <span class="op">&lt;-</span> <span class="va">df_text</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>wordsCount <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_count.html" class="external-link">str_count</a></span><span class="op">(</span><span class="va">text</span>, <span class="st">"\\S+"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="créer-des-corpus-selon-une-taille-de-segments">Créer des corpus selon une taille de segments<a class="anchor" aria-label="anchor" href="#cr%C3%A9er-des-corpus-selon-une-taille-de-segments"></a>
</h2>
<p>Initialement, la base de données <code>df_text</code> contient une
ligne par bloc de quelques mots.</p>
<p>Voici comment regrouper pour obtenir une ligne par vidéo :</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_video</span> <span class="op">&lt;-</span> <span class="va">df_text</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">suffix</span>,<span class="va">video_id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">text</span>,collapse <span class="op">=</span> <span class="st">" "</span><span class="op">)</span>,</span>
<span>            wordsCount <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">wordsCount</span>,na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>            .groups <span class="op">=</span> <span class="st">'drop'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df_video</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 4</span></span></span>
<span><span class="co">#&gt;   suffix video_id    text                                             wordsCount</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                 <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> bfm    6IOUEJN6GRI <span style="color: #949494;">"</span>' 'heure face- face, arrivé 'instant. géralde …       <span style="text-decoration: underline;">2</span>506</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> bfm    Ab_5e7jEoag <span style="color: #949494;">"</span>29 . dominique chelcher. apoline ' studio répo…       <span style="text-decoration: underline;">1</span>672</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> bfm    QA84_nDOREk <span style="color: #949494;">"</span>8h29 . marian maréchal, présidente parti ident…       <span style="text-decoration: underline;">1</span>800</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> bfm    mjdbw7M0LRI <span style="color: #949494;">"</span>' ' saura passe casse -midi, vote solennel bud…       <span style="text-decoration: underline;">1</span>778</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> bfm    p6Pzs3iGwNk <span style="color: #949494;">"</span>8h28 . sébastien chenu. . député rn nord, vice…       <span style="text-decoration: underline;">1</span>699</span></span></code></pre></div>
<p>Vous pouvez aussi décider de la durée (en minutes) de chaque segment
de vidéo. Ceci permet de contrôler différemment la division en segment
de texte réalisé par IRaMuTeQ ou par Quanteda.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">duree_segment</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span></span>
<span><span class="va">df_segment</span> <span class="op">&lt;-</span> <span class="va">df_text</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id_segment <span class="op">=</span> <span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">start</span><span class="op">/</span><span class="op">(</span><span class="va">duree_segment</span><span class="op">*</span><span class="fl">60</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">suffix</span>,<span class="va">video_id</span>,<span class="va">id_segment</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">start</span><span class="op">)</span>,end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">end</span><span class="op">)</span>,</span>
<span>            text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">text</span>, collapse <span class="op">=</span> <span class="st">" "</span><span class="op">)</span>,</span>
<span>            wordsCount <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">wordsCount</span>,na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>            .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df_segment</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">#&gt;   suffix video_id    id_segment  start   end text                     wordsCount</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> bfm    6IOUEJN6GRI          1   3.40  120. <span style="color: #949494;">"</span>' 'heure face- face, a…        185</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> bfm    6IOUEJN6GRI          2 120.    240. <span style="color: #949494;">"</span>pouvait pendant temps …        229</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> bfm    6IOUEJN6GRI          3 240.    363. <span style="color: #949494;">"</span>carcéral, prisons . en…        214</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> bfm    6IOUEJN6GRI          4 363.    481. <span style="color: #949494;">"</span>devrait territoire nat…        191</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> bfm    6IOUEJN6GRI          5 481.    600. <span style="color: #949494;">"</span>passe 'intérieur priso…        176</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> bfm    6IOUEJN6GRI          6 600.    721. <span style="color: #949494;">"</span>prison gardiens -mêmes…        188</span></span></code></pre></div>
<p>Les tableaux obtenus sont prêts pour l’export IRaMuTeQ ou l’analyse
Quanteda.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thomas Delclite.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
